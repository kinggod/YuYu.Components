!function(a,b){a.fn.asyncupload=function(c,d){var e=a(this);e.parent().css({position:"relative"});var f=a.extend({},a.fn.asyncupload.defaults,d),g="YuYu_FileField_"+Math.random(),h=!1,i=e.position().top,j=e.position().left,k=parseInt(e.css("width")),l=parseInt(e.css("height")),m=e.css("margin-top"),n=e.css("margin-right"),o=e.css("margin-bottom"),p=e.css("margin-left"),q=e.css("padding-top"),r=e.css("padding-right"),s=e.css("padding-bottom"),t=e.css("padding-left"),u=e.css("border-top-style"),v=e.css("border-right-style"),w=e.css("border-bottom-style"),x=e.css("border-left-style"),y=e.css("border-top-width"),z=e.css("border-right-width"),A=e.css("border-bottom-width"),B=e.css("border-left-width"),C=e.css("border-top-color"),D=e.css("border-right-color"),E=e.css("border-bottom-color"),F=e.css("border-left-color");e.css({opacity:0});try{h="undefined"!=new FormData}catch(G){h=!1}var H=h?a('<input type="file" id="'+g+'" />').css({position:"absolute",top:"-1px",right:"-1px",width:"1000px",height:"500px",margin:"0",padding:"0",opacity:"0",filter:"alpha(opacity=0)"}):null,I=""==e.val()?a("<span>\u672a\u9009\u62e9\u6587\u4ef6</span>").css({display:"block",marginRight:"60px",color:"#999",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}):a("<span>\u5df2\u4e0a\u4f20\u6587\u4ef6</span>").css({display:"block",marginRight:"60px",color:"#393",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}),J=a("<span></span>").css({display:"block","float":"right",width:"60px",color:"#090",textAlign:"right",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}),K=a("<div></div>").css({width:"0",height:"0",borderBottom:l-parseInt(.9*l)+"px solid #00f",fontSize:"0",lineHeight:"0",overflow:"hidden"});e.after(a("<div></div>").css({position:"absolute",top:i,left:j,width:k+"px",height:l+"px",marginTop:m,marginRight:n,marginBottom:o,marginLeft:p,paddingTop:q,paddingRight:r,paddingBottom:s,paddingLeft:t,borderTopStyle:u,borderRightStyle:v,borderBottomStyle:w,borderLeftStyle:x,borderTopWidth:y,borderRightWidth:z,borderBottomWidth:A,borderLeftWidth:B,borderTopColor:C,borderRightColor:D,borderBottomColor:E,borderLeftColor:F,borderSpacing:"1px",borderCollapse:"collapse",fontSize:"12px"}).append(a("<div></div>").css({"float":"right",width:"70px",height:l+"px",overflow:"hidden",backgroundColor:"#ccc"}).append(a(h?"<div></div>":'<div id="'+g+'"></div>').css({position:"relative",width:"70px",height:l+"px",lineHeight:l+"px",textAlign:"center",fontSize:"12px",backgroundColor:"#ccc",overflow:"hidden"}).append(h?a("<span>\u9009\u62e9\u6587\u4ef6</span>"):null).append(H))).append(a("<div></div>").css({marginRight:"72px"}).append(a("<div></div>").css({height:parseInt(.9*l)+"px",lineHeight:parseInt(.9*l)+"px"}).append(J).append(I)).append(a("<div></div>").css({width:"100%",margin:"0",padding:"0",backgroundColor:"#ccc"}).append(K)))),h?H.change(function(){var a=document.getElementById(g).files[0];if(a){var b=a.size>1048576?(Math.round(100*a.size/1048576)/100).toString()+"MB":(Math.round(100*a.size/1024)/100).toString()+"KB";if(I.text(a.name+"("+b+")"),"undefined"!=f.fileExtAllowd){var d=a.name.lastIndexOf("."),h=a.name.substring(d>-1?d:0);if("*.*"!=f.fileExtAllowd&&f.fileExtAllowd.indexOf(h)<0)return J.text("\u683c\u5f0f\u9519\u8bef\uff01"),void 0}if(a.size>f.fileSizeLimit)return J.text("\u6587\u4ef6\u592a\u5927\uff01"),void 0;var i=new FormData,j=new XMLHttpRequest;i.append("File",a),j.upload.addEventListener("progress",function(a){J.text(a.lengthComputable?Math.round(100*a.loaded/a.total)+"%":"\u6b63\u5728\u4e0a\u4f20\u2026");var b=parseFloat(K.parent().css("width"));K.css("width",Math.round(a.loaded*b/a.total)+"px")},!1),j.addEventListener("load",function(a){e.val(a.target.responseText),J.text("\u4e0a\u4f20\u6210\u529f\uff01"),K.css("width","100%"),f.callback&&f.callback(a.target.responseText)},!1),j.addEventListener("error",function(){J.text("\u4e0a\u4f20\u5931\u8d25\uff01")},!1),j.addEventListener("abort",function(){J.text("\u4e0a\u4f20\u53d6\u6d88\uff01")},!1),c&&""!=c&&(j.open("POST",c),j.send(i))}}):(e.after(a('<script type="text/javascript" src="/swfupload/swfupload.js"></script>')),b.onload=function(){new SWFUpload({flash_url:"../swfUpload/swfupload.swf",flash9_url:"../swfUpload/swfupload_fp9.swf",upload_url:c,file_size_limit:f.fileSizeLimit+"B",file_types:"undefined"==f.fileExtAllowd?"*.*":f.fileExtAllowd,file_upload_limit:1,file_queue_limit:1,debug:!1,button_window_mode:"transparent",button_width:"70",button_height:l,button_placeholder_id:g,button_text:'<span class="btn">\u9009\u62e9\u6587\u4ef6</span>',button_text_style:".btn {display:block;text-align:center;font-size:12px;}",button_text_top_padding:(l-(a.browser.msie||a.browser.opera?20:14))/2,file_dialog_complete_handler:function(){c&&""!=c&&this.startUpload()},upload_start_handler:function(a){a&&(a.size>1048576?(Math.round(100*a.size/1048576)/100).toString()+"MB":(Math.round(100*a.size/1024)/100).toString()+"KB",I.text(a.name+"("+a.size+")"))},upload_progress_handler:function(a,b){var c=b/a.size;c>=1&&(c=1),J.text(Math.round(100*c)+"%");var d=parseFloat(K.parent().css("width"));K.css("width",Math.round(c*d)+"px")},upload_error_handler:function(){J.text("\u4e0a\u4f20\u5931\u8d25\uff01")},upload_success_handler:function(a,b){e.val(b),f.callback&&f.callback(b)},upload_complete_handler:function(){J.text("\u4e0a\u4f20\u6210\u529f\uff01"),K.css("width","100%")}})})},a.fn.asyncupload.defaults={fileSizeLimit:4194304,fileExtAllowd:"*.jpg;*.jpeg;*.png;*.gif;*.bmp"}}(jQuery,Window);